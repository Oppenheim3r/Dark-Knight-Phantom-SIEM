# Generated by Django 5.2.6 on 2025-12-13 20:16

import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='EventCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(choices=[('AUTHENTICATION', 'Authentication'), ('AUTHORIZATION', 'Authorization'), ('PROCESS', 'Process Execution'), ('NETWORK', 'Network Activity'), ('FILE', 'File System'), ('REGISTRY', 'Registry'), ('SERVICE', 'Service'), ('SCHEDULED_TASK', 'Scheduled Task'), ('ACCOUNT_MANAGEMENT', 'Account Management'), ('GROUP_POLICY', 'Group Policy'), ('ACTIVE_DIRECTORY', 'Active Directory'), ('KERBEROS', 'Kerberos'), ('POWERSHELL', 'PowerShell'), ('WMI', 'WMI'), ('DNS', 'DNS'), ('DHCP', 'DHCP'), ('FIREWALL', 'Firewall'), ('DEFENDER', 'Windows Defender'), ('CERTIFICATE', 'Certificate Services'), ('RDP', 'Remote Desktop'), ('SMB', 'SMB/File Share'), ('SYSMON', 'Sysmon'), ('OTHER', 'Other')], max_length=50, unique=True)),
                ('description', models.TextField(blank=True)),
            ],
            options={
                'verbose_name_plural': 'Event Categories',
                'db_table': 'event_categories',
            },
        ),
        migrations.CreateModel(
            name='EventSource',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255, unique=True)),
                ('provider', models.CharField(blank=True, max_length=255)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'db_table': 'event_sources',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='RawEventBatch',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('agent_id', models.CharField(db_index=True, max_length=100)),
                ('received_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('event_count', models.IntegerField(default=0)),
                ('raw_data', models.BinaryField()),
                ('is_processed', models.BooleanField(default=False)),
                ('processing_errors', models.TextField(blank=True)),
            ],
            options={
                'db_table': 'raw_event_batches',
                'ordering': ['-received_at'],
            },
        ),
        migrations.CreateModel(
            name='EventStatistics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('hour', models.DateTimeField(db_index=True)),
                ('hostname', models.CharField(db_index=True, max_length=255)),
                ('channel', models.CharField(max_length=255)),
                ('event_id', models.IntegerField()),
                ('count', models.IntegerField(default=0)),
            ],
            options={
                'db_table': 'event_statistics',
                'ordering': ['-hour'],
                'unique_together': {('hour', 'hostname', 'channel', 'event_id')},
            },
        ),
        migrations.CreateModel(
            name='SecurityEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_id', models.IntegerField(db_index=True)),
                ('event_record_id', models.BigIntegerField(blank=True, null=True)),
                ('correlation_id', models.UUIDField(blank=True, db_index=True, null=True)),
                ('timestamp', models.DateTimeField(db_index=True)),
                ('received_at', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('channel', models.CharField(db_index=True, max_length=255)),
                ('provider_name', models.CharField(db_index=True, max_length=255)),
                ('provider_guid', models.CharField(blank=True, max_length=50)),
                ('hostname', models.CharField(db_index=True, max_length=255)),
                ('domain', models.CharField(blank=True, db_index=True, max_length=255)),
                ('ip_address', models.GenericIPAddressField(blank=True, db_index=True, null=True)),
                ('agent_id', models.CharField(db_index=True, max_length=100)),
                ('severity', models.CharField(choices=[('INFO', 'Informational'), ('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High'), ('CRITICAL', 'Critical')], db_index=True, default='INFO', max_length=20)),
                ('level', models.IntegerField(default=0)),
                ('level_name', models.CharField(blank=True, max_length=50)),
                ('task', models.IntegerField(default=0)),
                ('task_name', models.CharField(blank=True, max_length=255)),
                ('opcode', models.IntegerField(default=0)),
                ('opcode_name', models.CharField(blank=True, max_length=100)),
                ('keywords', models.CharField(blank=True, max_length=255)),
                ('message', models.TextField(blank=True)),
                ('raw_xml', models.TextField(blank=True)),
                ('event_data', models.JSONField(default=dict)),
                ('user_data', models.JSONField(blank=True, default=dict)),
                ('system_data', models.JSONField(blank=True, default=dict)),
                ('user_name', models.CharField(blank=True, db_index=True, max_length=255)),
                ('user_domain', models.CharField(blank=True, max_length=255)),
                ('user_sid', models.CharField(blank=True, db_index=True, max_length=100)),
                ('target_user_name', models.CharField(blank=True, db_index=True, max_length=255)),
                ('target_user_domain', models.CharField(blank=True, max_length=255)),
                ('target_user_sid', models.CharField(blank=True, max_length=100)),
                ('process_id', models.IntegerField(blank=True, db_index=True, null=True)),
                ('process_name', models.CharField(blank=True, db_index=True, max_length=500)),
                ('process_path', models.TextField(blank=True)),
                ('command_line', models.TextField(blank=True)),
                ('parent_process_id', models.IntegerField(blank=True, null=True)),
                ('parent_process_name', models.CharField(blank=True, max_length=500)),
                ('parent_command_line', models.TextField(blank=True)),
                ('source_ip', models.GenericIPAddressField(blank=True, db_index=True, null=True)),
                ('source_port', models.IntegerField(blank=True, null=True)),
                ('destination_ip', models.GenericIPAddressField(blank=True, db_index=True, null=True)),
                ('destination_port', models.IntegerField(blank=True, null=True)),
                ('protocol', models.CharField(blank=True, max_length=20)),
                ('logon_type', models.IntegerField(blank=True, null=True)),
                ('logon_type_name', models.CharField(blank=True, max_length=50)),
                ('logon_id', models.CharField(blank=True, max_length=50)),
                ('authentication_package', models.CharField(blank=True, max_length=100)),
                ('workstation_name', models.CharField(blank=True, max_length=255)),
                ('object_name', models.TextField(blank=True)),
                ('object_type', models.CharField(blank=True, max_length=100)),
                ('access_mask', models.CharField(blank=True, max_length=50)),
                ('service_name', models.CharField(blank=True, db_index=True, max_length=255)),
                ('service_type', models.CharField(blank=True, max_length=100)),
                ('service_start_type', models.CharField(blank=True, max_length=50)),
                ('service_account', models.CharField(blank=True, max_length=255)),
                ('object_dn', models.TextField(blank=True)),
                ('object_guid', models.CharField(blank=True, max_length=50)),
                ('object_class', models.CharField(blank=True, max_length=100)),
                ('attribute_name', models.CharField(blank=True, max_length=255)),
                ('attribute_value', models.TextField(blank=True)),
                ('ticket_encryption_type', models.CharField(blank=True, max_length=50)),
                ('ticket_options', models.CharField(blank=True, max_length=50)),
                ('service_name_kerberos', models.CharField(blank=True, max_length=255)),
                ('file_hash_md5', models.CharField(blank=True, max_length=32)),
                ('file_hash_sha1', models.CharField(blank=True, max_length=40)),
                ('file_hash_sha256', models.CharField(blank=True, db_index=True, max_length=64)),
                ('status', models.CharField(blank=True, max_length=50)),
                ('status_code', models.CharField(blank=True, max_length=20)),
                ('failure_reason', models.CharField(blank=True, max_length=255)),
                ('full_text', models.TextField(blank=True)),
                ('tags', models.JSONField(blank=True, default=list)),
                ('is_processed', models.BooleanField(default=False)),
                ('is_alerted', models.BooleanField(default=False)),
                ('category', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='events.eventcategory')),
                ('source', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='events', to='events.eventsource')),
            ],
            options={
                'db_table': 'security_events',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['event_id', 'timestamp'], name='security_ev_event_i_b16f3c_idx'), models.Index(fields=['hostname', 'timestamp'], name='security_ev_hostnam_f69a66_idx'), models.Index(fields=['channel', 'timestamp'], name='security_ev_channel_1fcc09_idx'), models.Index(fields=['severity', 'timestamp'], name='security_ev_severit_db68de_idx'), models.Index(fields=['user_name', 'timestamp'], name='security_ev_user_na_23bc8b_idx'), models.Index(fields=['process_name', 'timestamp'], name='security_ev_process_758bd0_idx'), models.Index(fields=['source_ip', 'timestamp'], name='security_ev_source__833b64_idx'), models.Index(fields=['agent_id', 'timestamp'], name='security_ev_agent_i_a970d4_idx')],
            },
        ),
    ]
